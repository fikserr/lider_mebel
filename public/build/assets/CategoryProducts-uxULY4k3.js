import{r as e,j as a,$ as s,Y as l,a as r}from"./app-BYElD7EB.js";import{H as t}from"./index-CU9DNees.js";import{I as o,a as i}from"./index-bxfBY9vS.js";import{a as n,F as c}from"./filter-sidebar-BdkGkAS8.js";import{u as d}from"./use-toast-DsNCB_oK.js";import"./iconBase-BvghSGLp.js";const m=({category:m,products:h=[],categories:u=[],favorites:g=[]})=>{const{toast:x}=d(),[v,p]=e.useState("default"),[f,j]=e.useState((null==m?void 0:m.id)??null),[N,b]=e.useState([]),[y,C]=e.useState([]),[S,w]=e.useState([]),[k,P]=e.useState({minPrice:"",maxPrice:""}),[M,z]=e.useState(g),E=e.useMemo(()=>{const e={};return null==M||M.forEach(a=>{e[a.id]=!0}),e},[M]),[B,q]=e.useState(E);console.log("=== CategoryProducts Debug ==="),console.log("category:",m),console.log("categories:",u),console.log("categories.length:",u.length),console.log("products:",h),console.log("products.length:",h.length);const F=e.useMemo(()=>[...new Set(h.map(e=>e.brend).filter(Boolean))],[h]),H=e.useMemo(()=>{const e=[];return h.forEach(a=>{var s;null==(s=a.variants)||s.forEach(a=>{var s;null==(s=a.colors)||s.forEach(a=>e.push(a))})}),[...new Set(e)]},[h]),$=e.useMemo(()=>{const e=[];return h.forEach(a=>{var s;null==(s=a.variants)||s.forEach(a=>{var s;null==(s=a.sizes)||s.forEach(a=>e.push(a))})}),[...new Set(e)]},[h]);console.log("allBrands:",F),console.log("allColors:",H),console.log("allSizes:",$);const _=e.useMemo(()=>{let e=[...h];if(f&&(e=e.filter(e=>e.category_id===f)),N.length&&(e=e.filter(e=>N.includes(e.brend))),y.length&&(e=e.filter(e=>{var a;return null==(a=e.variants)?void 0:a.some(e=>{var a;return null==(a=e.colors)?void 0:a.some(e=>y.includes(e))})})),S.length&&(e=e.filter(e=>{var a;return null==(a=e.variants)?void 0:a.some(e=>{var a;return null==(a=e.sizes)?void 0:a.some(e=>S.includes(e))})})),k.minPrice||k.maxPrice){const a=Number(k.minPrice||0),s=Number(k.maxPrice||1/0);e=e.filter(e=>{var l;return null==(l=e.variants)?void 0:l.some(e=>e.price>=a&&e.price<=s)})}return e},[h,f,N,y,S,k]),L=()=>{j((null==m?void 0:m.id)??null),b([]),C([]),w([]),P({minPrice:"",maxPrice:""}),p("default")};return a.jsxs(a.Fragment,{children:[a.jsx(s,{title:m.name}),a.jsxs("div",{className:"px-5 xl:px-20 mt-20",children:[a.jsxs(l,{href:"/",className:"inline-flex items-center mb-4 hover:opacity-70",children:[a.jsx(t,{className:"mr-2 text-xl"}),a.jsx("h1",{className:"text-3xl md:text-4xl font-bold",children:m.name})]}),a.jsx("div",{className:"mb-6 pl-7",children:a.jsxs("p",{className:"text-gray-600 ",children:[_.length," ta mahsulot"]})}),a.jsxs("div",{className:"flex gap-6 2xl:gap-32",children:[a.jsx("aside",{className:"hidden xl:block w-64 flex-shrink-0",children:a.jsx("div",{className:"sticky top-20",children:a.jsx(n,{categories:u,selectedCategory:f,onCategoryChange:j,brands:F,variantsColors:H,variantsSizes:$,onBrandChange:b,onColorChange:C,onSizeChange:w,onPriceChange:P,onClearFilters:L})})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"xl:hidden",children:a.jsx(c,{categories:u,selectedCategory:f,onCategoryChange:j,brands:F,colors:H,sizes:$,onBrandChange:b,onColorChange:C,onSizeChange:w,onPriceChange:P})}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-4 gap-5",children:_.map(e=>{var s,t;const n=B[e.id];return a.jsxs(l,{href:`/detail/${e.id}`,className:"bg-white rounded-lg shadow hover:shadow-lg transition-all duration-300 group relative",children:[a.jsx("div",{className:"overflow-hidden rounded-t-lg",children:a.jsx("img",{src:`/storage/${e.photo1}`,alt:e.product_name,className:"h-48 w-full object-cover group-hover:scale-110 transition-transform duration-300",onError:e=>{e.target.onerror=null,e.target.src="/placeholder.png"}})}),a.jsx("button",{onClick:a=>(async(e,a)=>{e.preventDefault(),e.stopPropagation();try{if(B[a])await r.delete(`/favorites/${a}`),x({title:"Sevimlilardan o'chirildi",description:"✅ Mahsulot o'chirildi"}),z(e=>e.filter(e=>e.id!==a));else{await r.post("/favorites",{product_id:a}),x({title:"Sevimlilarga qo'shildi",description:"✅ Mahsulot qo'shildi"});const e=h.find(e=>e.id===a);z(a=>[...a,e])}q(e=>({...e,[a]:!e[a]}))}catch(s){console.error(s),x({title:"Xatolik",description:B[a]?"Sevimlilardan o'chirishda xatolik ❌":"Sevimlilarga qo'shishda xatolik ❌",variant:"destructive"})}})(a,e.id),className:"absolute top-2 right-2 p-2 rounded-full transition-all duration-200","aria-label":n?"Sevimlilardan o'chirish":"Sevimlilarga qo'shish",children:n?a.jsx(o,{className:"text-xl text-yellow-400"}):a.jsx(i,{className:"text-xl text-gray-600"})}),a.jsxs("div",{className:"p-3",children:[a.jsx("h3",{className:"font-semibold line-clamp-2 mb-1",children:e.product_name}),a.jsx("p",{className:"text-sm text-gray-500",children:e.brend}),(null==(t=null==(s=e.variants)?void 0:s[0])?void 0:t.price)&&a.jsxs("p",{className:"text-sm font-bold mt-1",children:[e.variants[0].price.toLocaleString()," so'm"]})]})]},e.id)})}),!_.length&&a.jsxs("div",{className:"text-center mt-16 py-12",children:[a.jsx("div",{className:"text-gray-400 mb-4",children:a.jsx("svg",{className:"mx-auto h-24 w-24",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})})}),a.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"Mahsulotlar topilmadi"}),a.jsx("p",{className:"text-gray-500",children:"Filtr shartlariga mos mahsulot yo'q"}),a.jsx("button",{onClick:L,className:"mt-4 px-6 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors",children:"Filtrlarni tozalash"})]})]})]})]})]})};export{m as default};
